<main>
  <header id="channel-header" {{action "menu" "global" "toggle"}} onClick="">
    <h2 id="channel-name" class={{if channel.connected "connected" "disconnected"}}>{{channel.name}}</h2>
    <p id="channel-title">{{channel.formattedTopic}}</p>
    <nav>
      <a href="#"><i class="icon-megaphone"></i></a><a href="#"><i class="icon-mute"></i></a>
    </nav>
  </header>

  <section id="channel-content" class="main">
    {{#if channel.isLogged}}
      <a onclick={{perform loadPreviousMessages}} class="load-previous" role="button">
        Load previous messages
      </a>
    {{/if}}

    <ul>
      <li>
        {{scrolling-observer rootElement="#channel-content"
                             rootMargin=partialRenderingObserverMargin
                             enabled=partialRenderingEnabled
                             onIntersect=(action "increaseRenderedMessagesCount")}}
      </li>
      {{#each renderedMessages as |message|}}
        <li>
          {{component message.type message=message
                      onUsernameClick=(action "addUsernameMentionToMessage")}}
        </li>
      {{else}}
        {{#if channel.isLogged}}
          <li class="no-messages discreet">No recent messages to display.</li>
        {{else}}
          <li class="no-messages discreet">No Kosmos logs configured for this channel. <a href="https://wiki.kosmos.org/Setting_up_channel_logs" target="_blank" rel="noopener">Learn more</a></li>
        {{/if}}
      {{/each}}
      <li>
        {{scrolling-observer rootElement=element
                             rootMargin="0px"
                             threshold=1
                             retriggeringEnabled=false
                             onIntersect=(action "setAutomaticScrolling" true)
                             onDiverge=(action "setAutomaticScrolling" false)}}
      </li>
    </ul>
  </section>

  <footer>
    {{message-input message=newMessage
                    onSend=(action "processMessageOrCommand")
                    usernames=channel.userList}}
  </footer>
</main>

<aside>
  <header>
    <nav>
      {{#link-to "index" class="active"}}<i class="icon-users"></i>{{/link-to}}<a href="#"><i class="icon-paperclip"></i></a>{{#link-to "settings"}}<i class="icon-cog"></i>{{/link-to}}<a href="#"><i class="icon-resize-enlarge"></i></a>
    </nav>
  </header>

  {{user-list users=channel.sortedUserList}}
</aside>
