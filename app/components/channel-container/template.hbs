<main>
  <header id="channel-header">
    <h2 id="channel-name"
        class={{if channel.connected "connected" "disconnected"}}
        {{action "menu" "global" "toggle"}}>
      {{channel.name}}
    </h2>
    <p id="channel-title">
      {{channel.formattedTopic}}
    </p>
    <nav>
      {{#link-to "index" class="active"}}<IconUsers />{{/link-to}}<a><IconPaperclip /></a><a><IconSettings /></a><a {{action "leaveChannel" space channel}} title="Leave {{channel.name}}"><IconLogOut /></a>
    </nav>
  </header>

  <div class="content-container">
    <div class="content">
      <section id="channel-content" class="main">
        {{#if channel.isLogged}}
          <a onclick={{perform loadPreviousMessages}} class="load-previous" role="button">
            Load previous messages
          </a>
        {{/if}}

        <ul>
          <li>
            {{scrolling-observer rootElement="#channel-content"
                                 rootMargin=partialRenderingObserverMargin
                                 enabled=partialRenderingEnabled
                                 onIntersect=(action "increaseRenderedMessagesCount")}}
          </li>
          {{#each renderedMessages as |message|}}
            <li>
              {{component message.type message=message
                          onUsernameClick=(action "addUsernameMentionToMessage")}}
            </li>
          {{else}}
            {{#if channel.isLogged}}
              <li class="no-messages discreet">No recent messages to display.</li>
            {{else}}
              <li class="no-messages discreet">No Kosmos logs configured for this channel. <a href="https://wiki.kosmos.org/Setting_up_channel_logs" target="_blank" rel="noopener">Learn more</a></li>
            {{/if}}
          {{/each}}
          <li>
            {{scrolling-observer rootElement=element
                                 rootMargin="0px"
                                 threshold=1
                                 retriggeringEnabled=false
                                 onIntersect=(action "setAutomaticScrolling" true)
                                 onDiverge=(action "setAutomaticScrolling" false)}}
          </li>
        </ul>
      </section>

      <footer>
        <MessageInput @message={{newMessage}}
                      @sendMessage={{action "processMessageOrCommand"}}
                      @usernames={{channel.userList}} />
      </footer>
    </div>

    <aside>
      <UserList @users={{channel.sortedUserList}} />
    </aside>
  </div>
</main>
